{% extends 'adminBase.html' %}
{% load static %}
{% block title %} Add Product {% endblock %}
{% block content %}

<main class="flex-grow-1 overflow-auto p-4 p-md-5">
    <div class="container">
        <h2 class="text-center fw-bold pb-3">{% if edit_mode %}Edit Product{% else %}Add Product{% endif %}</h2>
        <div class="container">
            <div class="row align-items-start">
                <!-- Left: Image Preview -->
                <div class="col-md-6 px-auto border border-ligth mb-5" style="height: 450px;">
                    <img id="imagePreview" src="" alt="Preview will appear here" 
                        style="max-width: 450px; display:none; border:1px solid #ddd; padding:5px; color: #fff;" />
                </div>

                <!-- Right: Form -->
                <div class="col-md-6">
                    <form method="POST" id="productForm">
                        {% csrf_token %}

                        <!-- Product Name -->
                        <div class="mb-3">
                            <label class="form-label">Product Name</label>
                            {{ product_form.prodnameid }}
                        </div>

                        <!-- Product Color -->
                        <div class="mb-3">
                            <label class="form-label">Product Color</label>
                            {{ product_form.colorid }}
                        </div>

                        <!-- Product Price -->
                        <div class="mb-3">
                            <label class="form-label">Product Price</label>
                            {{ product_form.priceid }}
                        </div>

                        <!-- Product Image URL -->
                        <div class="mb-3">
                            <label for="id_productimage" >Product Image:</label>
                            <input type="url" class="form-control" name="productimage" maxlength="255" id="id_productimage" value="{{ product_form.productimage.value }}">
                        </div>

                        <!-- Submit Button -->
                        <div class="mb-3">
                            <button type="submit" class="btn btn-primary w-100" id="submitBtn" disabled>
                                {% if edit_mode %}Save Changes{% else %}Create Product{% endif %}
                            </button>
                        </div>

                        {% if edit_mode %}
                            <input type="hidden" name="productid" value="{{ product_id }}">
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <table class="table table-dark table-striped table-bordered table-hover text-center align-middle shadow-sm">
            <thead>
                <tr>
                    <th class="text-light text-center fw-bold">Product ID</th>
                    <th class="text-light text-center fw-bold">Product Name</th>
                    <th class="text-light text-center fw-bold">Color</th>
                    <th class="text-light text-center fw-bold">Price</th>
                    <th class="text-light text-center fw-bold">Image</th>
                    <th class="text-light text-center fw-bold">Edit</th>
                    <th class="text-light text-center fw-bold">Delete</th>
                </tr>
            </thead>
            <tbody class="text-light">
                {% for product in products %}
                    <tr class="text-light">
                        <td>{{ product.productid }}</td>
                        <td>{{ product.prodnameid.name }}</td>
                        <td>{{ product.colorid.colorname }}</td>
                        <td>{{ product.priceid.amount }}</td>
                        <td>
                            <img src="{{ product.productimage }}" alt="{{ product.prodnameid.name }}" style="max-width: 100px; max-height: 100px; object-fit: cover;">
                        </td>
                        <td>
                            <form method="GET" action="{% url 'addProduct' %}">
                                <button type="submit" class="btn btn-warning" name="edit" value="{{ product.productid }}">Edit</button>
                            </form>
                        </td>
                        <td>
                            <form method="POST">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger" name="delete" value="{{ product.productid }}">Delete</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</main>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("productForm");
        const submitBtn = document.getElementById("submitBtn");
        const imageInput = document.getElementById("id_productimage");
        const preview = document.getElementById("imagePreview");

        // These are the 3 select dropdowns
        const dropdowns = [
            document.getElementById("id_prodnameid"),
            document.getElementById("id_colorid"),
            document.getElementById("id_priceid"),
        ];

        function updatePreview() {
            const url = imageInput.value.trim();
            if (url) {
                preview.src = url;
                preview.style.display = "block";
            } else {
                preview.src = "";
                preview.style.display = "none";
            }
        }

        function validateForm() {
            const imageFilled = imageInput.value.trim() !== "";

            // Check if all dropdowns have a selected value
            const allSelected = dropdowns.every(select => {
                const value = select.value.trim();
                return value !== "" && value !== "0";
            });

            submitBtn.disabled = !(imageFilled && allSelected);
        }

        // Event listeners
        imageInput.addEventListener("input", function () {
            updatePreview();
            validateForm();
        });

        dropdowns.forEach(select => {
            select.addEventListener("change", validateForm);
        });

        // Initial run
        updatePreview();
        validateForm();
    });
</script>


{% endblock %}
